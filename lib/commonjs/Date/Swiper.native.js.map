{"version":3,"names":["styles","StyleSheet","create","viewPager","flex","inner","position","getVisibleArray","i","isHorizontal","height","Swiper","props","width","SwiperInner","scrollMode","renderItem","renderHeader","renderFooter","selectedYear","initialIndex","idx","React","useRef","visibleIndexes","setVisibleIndexes","useState","parentRef","scrollTo","useCallback","index","animated","current","offset","getHorizontalMonthOffset","getVerticalMonthsOffset","montHeaderHeight","y","x","onPrev","onNext","scrollToInitial","onMomentumScrollEnd","e","contentOffset","nativeEvent","viewSize","layoutMeasurement","newIndex","Math","floor","getIndexFromVerticalOffset","beginOffset","renderProps","useYearChange","currentIndexRef","estimatedMonthHeight","totalMonths","Array","length","fill","undefined","map","_","vi","top","left","right","bottom","getMonthHeight","memo"],"sources":["Swiper.native.tsx"],"sourcesContent":["import * as React from 'react'\nimport {\n  NativeScrollEvent,\n  NativeSyntheticEvent,\n  ScrollView,\n  StyleSheet,\n  View,\n} from 'react-native'\nimport {\n  getHorizontalMonthOffset,\n  getIndexFromVerticalOffset,\n  getMonthHeight,\n  getVerticalMonthsOffset,\n  montHeaderHeight,\n} from './Month'\n\nimport { SwiperProps, useYearChange } from './SwiperUtils'\nimport { beginOffset, estimatedMonthHeight, totalMonths } from './dateUtils'\nimport AutoSizer from './AutoSizer'\n\nconst styles = StyleSheet.create({\n  viewPager: {\n    flex: 1,\n  },\n  inner: {\n    position: 'relative',\n  },\n})\n\nfunction getVisibleArray(\n  i: number,\n  { isHorizontal, height }: { isHorizontal: boolean; height: number }\n) {\n  if (isHorizontal || height < 700) {\n    return [i - 1, i, i + 1]\n  }\n  return [i - 2, i - 1, i, i + 1, i + 2]\n}\n\nfunction Swiper(props: SwiperProps) {\n  return (\n    <AutoSizer>\n      {({ width, height }) => (\n        <SwiperInner {...props} width={width} height={height} />\n      )}\n    </AutoSizer>\n  )\n}\n\nfunction SwiperInner({\n  scrollMode,\n  renderItem,\n  renderHeader,\n  renderFooter,\n  selectedYear,\n  initialIndex,\n  width,\n  height,\n}: SwiperProps & { width: number; height: number }) {\n  const idx = React.useRef<number>(initialIndex)\n  const isHorizontal = scrollMode === 'horizontal'\n  const [visibleIndexes, setVisibleIndexes] = React.useState<number[]>(\n    getVisibleArray(initialIndex, { isHorizontal, height })\n  )\n\n  const parentRef = React.useRef<ScrollView | null>(null)\n\n  const scrollTo = React.useCallback(\n    (index: number, animated: boolean) => {\n      idx.current = index\n      setVisibleIndexes(getVisibleArray(index, { isHorizontal, height }))\n\n      if (!parentRef.current) {\n        return\n      }\n      const offset = isHorizontal\n        ? getHorizontalMonthOffset(index, width)\n        : getVerticalMonthsOffset(index) - montHeaderHeight\n\n      if (isHorizontal) {\n        parentRef.current.scrollTo({\n          y: 0,\n          x: offset,\n          animated,\n        })\n      } else {\n        parentRef.current.scrollTo({\n          y: offset,\n          x: 0,\n          animated,\n        })\n      }\n    },\n    [parentRef, isHorizontal, width, height]\n  )\n\n  const onPrev = React.useCallback(() => {\n    scrollTo(idx.current - 1, true)\n  }, [scrollTo, idx])\n\n  const onNext = React.useCallback(() => {\n    scrollTo(idx.current + 1, true)\n  }, [scrollTo, idx])\n\n  const scrollToInitial = React.useCallback(() => {\n    scrollTo(idx.current, false)\n  }, [scrollTo])\n\n  const onMomentumScrollEnd = React.useCallback(\n    (e: NativeSyntheticEvent<NativeScrollEvent>) => {\n      const contentOffset = e.nativeEvent.contentOffset\n      const viewSize = e.nativeEvent.layoutMeasurement\n      const newIndex = isHorizontal\n        ? Math.floor(contentOffset.x / viewSize.width)\n        : getIndexFromVerticalOffset(contentOffset.y - beginOffset)\n\n      if (newIndex === 0) {\n        return\n      }\n\n      if (idx.current !== newIndex) {\n        idx.current = newIndex\n        setVisibleIndexes(getVisibleArray(newIndex, { isHorizontal, height }))\n      }\n    },\n    [idx, height, isHorizontal]\n  )\n\n  const renderProps = {\n    index: 0,\n    onPrev,\n    onNext,\n  }\n\n  useYearChange(\n    (newIndex) => {\n      if (newIndex) {\n        scrollTo(newIndex, false)\n      }\n    },\n    {\n      selectedYear,\n      currentIndexRef: idx,\n    }\n  )\n\n  return (\n    <>\n      <ScrollView\n        scrollsToTop={false}\n        ref={parentRef}\n        horizontal={isHorizontal}\n        pagingEnabled={isHorizontal}\n        style={styles.viewPager}\n        onMomentumScrollEnd={onMomentumScrollEnd}\n        onScrollEndDrag={onMomentumScrollEnd}\n        onLayout={scrollToInitial}\n        showsHorizontalScrollIndicator={false}\n        showsVerticalScrollIndicator={false}\n        decelerationRate=\"fast\"\n        scrollEventThrottle={10}\n      >\n        <View\n          style={[\n            styles.inner,\n            {\n              height: isHorizontal\n                ? height\n                : estimatedMonthHeight * totalMonths,\n              width: isHorizontal ? width * totalMonths : width,\n            },\n          ]}\n        >\n          {visibleIndexes\n            ? new Array(visibleIndexes.length).fill(undefined).map((_, vi) => (\n                <View\n                  key={vi}\n                  style={{\n                    top: isHorizontal\n                      ? 0\n                      : getVerticalMonthsOffset(visibleIndexes[vi]),\n                    left: isHorizontal\n                      ? getHorizontalMonthOffset(visibleIndexes[vi], width)\n                      : 0,\n                    right: isHorizontal ? undefined : 0,\n                    bottom: isHorizontal ? 0 : undefined,\n                    position: 'absolute',\n                    width: isHorizontal ? width : undefined,\n                    height: isHorizontal\n                      ? undefined\n                      : getMonthHeight(scrollMode, visibleIndexes[vi]),\n                  }}\n                >\n                  {renderItem({\n                    index: visibleIndexes[vi],\n                    onPrev: onPrev,\n                    onNext: onNext,\n                  })}\n                </View>\n              ))\n            : null}\n        </View>\n      </ScrollView>\n      {renderHeader && renderHeader(renderProps)}\n      {renderFooter && renderFooter(renderProps)}\n    </>\n  )\n}\n\nexport default React.memo(Swiper)\n"],"mappings":"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"}